file=paste0("event_records_",
start_time,
"_",
end_time,
".csv"),
append=FALSE,
quote=FALSE,
sep=";",
row.names=FALSE,
col.names=TRUE)
View(event_records)
View(event_records)
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_us_")))
View(model_data)
str(event_records)
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_us_"))) %>%
select(.,
cep_repronum_numeric,
leader_percentTerm_numeric,
c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal)
View(model_data)
lm(c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal ~.,
data=model_data)
summary(lm(c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal ~.,
summary(lm(c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal ~.,
data=model_data))
model <- lm(c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal ~.,
model <- lm(c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal ~.,
data=model_data)
summary(model)
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_us_"))) %>%
select(.,
cep_repronum_numeric,
leader_daysSinceBirth_integer,
c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal)
model <- lm(c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal ~.,
data=model_data)
summary(model)
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_us_"))) %>%
select(.,
cep_JHU_ConfirmedCases_change_integer,
leader_daysSinceBirth_integer,
c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal)
model <- lm(c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal ~.,
data=model_data)
summary(model)
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^country_"))) %>%
select(.,
cep_repronum_numeric,
c3_Apple_WalkingMobility_index,
c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal)
model <- lm(c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal ~.,
data=model_data)
summary(model)
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^country_"))) %>%
select(.,
cep_repronum_numeric,
c3_Apple_WalkingMobility_index,
c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal)
model <- lm(c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal ~.,
data=model_data)
summary(model)
if (!require(plyr)) install.packages('plyr')
if (!require(dplyr)) install.packages('dplyr')
if (!require(pbmcapply)) install.packages('pbmcapply')
if (!require(stats)) install.packages('stats')
if (!require(lubridate)) install.packages('lubridate')
if (!require(fuzzyjoin)) install.packages('fuzzyjoin')
if (!require(gtools)) install.packages('gtools')
if (!require(tidyr)) install.packages('tidyr')
if (!require(stringr)) install.packages('stringr')
if (!require(uuid)) install.packages('uuid')
if (!require(data.table)) install.packages('data.table')
if (!require(rlist)) install.packages('rlist')
library(plyr)
library(dplyr)
library(pbmcapply)
library(stats)
library(lubridate)
library(fuzzyjoin)
library(gtools)
library(tidyr)
library(stringr)
library(uuid)
library(data.table)
library(rlist)
seconds_back <- 6*60*60-1
seconds_ahead <- 6*60*60-1
start_time <- as.character(Sys.time())
#get existing scope for sampling
object_types <- read.csv(file="../events/objectTypeIDs.csv",
header=TRUE,
sep=";")
measures <- read.csv(file="../events/measureIDs.csv",
header=TRUE,
sep=";") %>%
mutate(.,
uuidMeasure=uuidMeasure,
description=paste0(source,
"_",
description,
"_",
scaleLevel),
number=seq(1,nrow(.)),
.keep="none")
objects <- read.csv(file="../events/objectIDs.csv",
header=TRUE,
sep=";") %>%
select(.,
-iso) %>%
left_join(.,
object_types,
by="uuidObjectType") %>%
mutate(.,
description=paste0(description.y,
"_",
description.x),
number=seq(1,nrow(.)),
.keep="unused")
valid_records <- expand.grid(measures$number,
objects$number) %>%
left_join(.,
measures,
by=c("Var1"="number")) %>%
left_join(.,
objects,
by=c("Var2"="number")) %>%
select(.,
-c(Var1,
Var2)) %>%
mutate(.,
eventType=paste0(uuidObjectType,
"_",
uuidMeasure))
#cross-check list against existing files
existing_files <- list.files(path="../events/") %>%
substr(.,
1,
nchar(.)-4)
valid_records <- valid_records[which(valid_records$eventType %in% existing_files),]
valid_records$number <- seq(1,
nrow(valid_records))
files <- unique(valid_records$eventType)
#get existing validity periods
timestamps <- pbmclapply(files,FUN=function(x) {
load(paste0("../events/",
x,
".rda"))
data <- mutate(data,
measurementTime=with_tz(data$measurementTime,
tzone="UTC"))
return(as.character(data$measurementTime))
},mc.cores=8L) %>%
unlist() %>%
unique()
timestamps <- interval(timestamps,
timestamps)
int_start(timestamps) <- int_start(timestamps) - seconds_back
int_end(timestamps) <- int_end(timestamps) + seconds_ahead
timestamps <- data.frame(validity=timestamps,
number=seq(1,
length(timestamps)))
#re-calculate valid records
valid_records <- expand.grid(valid_records$number,
timestamps$number) %>%
left_join(.,
valid_records,
by=c("Var1"="number")) %>%
left_join(.,
timestamps,
by=c("Var2"="number")) %>%
select(.,
-c(Var1,
Var2)) %>%
select(.,
eventType,
uuidMeasure,
uuidObject,
validity) %>%
dlply(.,
"eventType")
#load required event records
event_records <- pbmclapply(1:length(valid_records),FUN=function(x) {
load(paste0("../events/",
names(valid_records[x]),
".rda"))
data <- mutate(data,
measurementTime=with_tz(data$measurementTime,
tzone="UTC")) %>%
left_join(valid_records[[x]],
data,
by="uuidObject") %>%
.[which(.$measurementTime %within% .$validity),] %>%
select(.,
uuidMeasure,
uuidObject,
validity,
measurementValue) %>%
mutate(.,
validity=as.character(validity))
return(data)
},mc.cores=8L)
end_time <- as.character(Sys.time())
names(event_records) <- names(valid_records)
event_records <- event_records %>%
ldply(.parallel=TRUE,
.id="eventType") %>%
mutate(.,
uuidObjectType=substr(eventType,
1,
36),
measurementValue=as.numeric(measurementValue),
.keep="unused") %>%
left_join(.,
objects,
by=c("uuidObjectType",
"uuidObject")) %>%
select(.,
-c(uuidObjectType,
uuidObject,
number)) %>%
left_join(.,
measures,
by="uuidMeasure") %>%
select(.,
-c(uuidMeasure,
number)) %>%
mutate(.,
object=description.x,
validity=validity,
measure=description.y,
measurementValue=measurementValue,
.keep="none") %>%
distinct(.,
object,
validity,
measure,
.keep_all=TRUE) %>%
pivot_wider(.,
names_from=measure,
values_from=measurementValue,
values_fill=NA)
write.table(event_records,
file=paste0("event_records_",
start_time,
"_",
end_time,
".csv"),
append=FALSE,
quote=FALSE,
sep=";",
row.names=FALSE,
col.names=TRUE)
View(event_records)
str(event_records)
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_party_nominal,
c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal)
model_data
complete.cases(model_data)
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_party_nominal,
c3_OxCGRT_Policy_StringencyIndex_mean_of_ordinal) %>%
.[which(complete.cases(.)),]
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),]
model_data
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_gender_nominal,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),] %>%
mutate(.,
party=case_when(leader_party_nominal=1 ~ 1,
leader_party_nominal=2 ~ 0,
leader_party_nominal=3 ~ 0,
leader_party_nominal=4 ~ 0,
TRUE ~ NA),
gender=case_when(leader_gender_nominal=="male" ~ 1,
leader_gender_nominal=="female" ~ 0,
TRUE ~ 0))
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_gender_nominal,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),] %>%
mutate(.,
party=case_when(leader_party_nominal=1 ~ 1,
leader_party_nominal=2 ~ 0,
leader_party_nominal=3 ~ 0,
leader_party_nominal=4 ~ 0,
TRUE ~ NA),
gender=case_when(leader_gender_nominal=1 ~ 1,
leader_gender_nominal=2 ~ 0,
TRUE ~NA))
View(model_data)
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_gender_nominal,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),]
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_gender_nominal,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),] %>%
mutate(.,
party=case_when(leader_party_nominal==1 ~ 1,
leader_party_nominal==2 ~ 0,
leader_party_nominal==3 ~ 0,
leader_party_nominal==4 ~ 0,
TRUE ~ NA),
gender=case_when(leader_gender_nominal==1 ~ 1,
leader_gender_nominal==2 ~ 0,
TRUE ~NA))
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_gender_nominal,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),] %>%
mutate(.,
leader_party_nominal=case_when(leader_party_nominal==1 ~ 1,
leader_party_nominal==2 ~ 0,
leader_party_nominal==3 ~ 0,
leader_party_nominal==4 ~ 0,
TRUE ~ NA),
leader_gender_nominal=case_when(leader_gender_nominal==1 ~ 1,
leader_gender_nominal==2 ~ 0,
TRUE ~NA))
model_data[which(model_data$leader_gender_nominal==2),]$leader_gender_nominal <- 0
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_gender_nominal,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),]
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),]
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),]
model_data[which(model_data$leader_party_nominal>=1),]$leader_party_nominal <- 0
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_party_nominal,
c3_Apple_TransitMobility_index) %>%
.[which(complete.cases(.)),]
model_data[which(model_data$leader_party_nominal>1),]$leader_party_nominal <- 0
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_party_nominal,
c3_Google_TransitStationsMobility_index) %>%
.[which(complete.cases(.)),]
model_data[which(model_data$leader_party_nominal>1),]$leader_party_nominal <- 0
model <- lm(c3_Google_TransitStationsMobility_index ~.,
data=model_data)
summary(model)
#impact of US governor party affiliation on transit mobility
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_us_"))) %>%
select(.,
cep_repronum_numeric,
leader_party_nominal,
c3_Google_TransitStationsMobility_index) %>%
.[which(complete.cases(.)),]
model_data[which(model_data$leader_party_nominal>1),]$leader_party_nominal <- 0
model <- lm(c3_Google_TransitStationsMobility_index ~.,
data=model_data)
summary(model)
#impact of German PM party affiliation on transit mobility, using cases
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_JHU_ConfirmedCases_change_integer,
leader_party_nominal,
c3_Google_TransitStationsMobility_index) %>%
.[which(complete.cases(.)),]
model_data[which(model_data$leader_party_nominal>1),]$leader_party_nominal <- 0
model <- lm(c3_Google_TransitStationsMobility_index ~.,
data=model_data)
summary(model)
#impact of US governor party affiliation on transit mobility, using cases
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_us_"))) %>%
select(.,
cep_JHU_ConfirmedCases_change_integer,
leader_party_nominal,
c3_Google_TransitStationsMobility_index) %>%
.[which(complete.cases(.)),]
model_data[which(model_data$leader_party_nominal>1),]$leader_party_nominal <- 0
model <- lm(c3_Google_TransitStationsMobility_index ~.,
data=model_data)
summary(model)
#impact of German PM gender on transit mobility, using reproduction number
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_de_"))) %>%
select(.,
cep_repronum_numeric,
leader_gender_nominal,
c3_Google_TransitStationsMobility_index) %>%
.[which(complete.cases(.)),]
model_data[which(model_data$leader_gender_nominal>1),]$leader_gender_nominal <- 0
model <- lm(c3_Google_TransitStationsMobility_index ~.,
data=model_data)
summary(model)
#impact of US governor gender on transit mobility, using reproduction number
model_data <- event_records %>%
filter(.,
str_detect(object,
regex("^state_us_"))) %>%
select(.,
cep_repronum_numeric,
leader_gender_nominal,
c3_Google_TransitStationsMobility_index) %>%
.[which(complete.cases(.)),]
model_data[which(model_data$leader_gender_nominal>1),]$leader_gender_nominal <- 0
model <- lm(c3_Google_TransitStationsMobility_index ~.,
data=model_data)
summary(model)
